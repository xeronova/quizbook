일일 퀴즈 유지보수를 수행하라. 아래 7단계를 **순서대로** 실행하며, 각 단계가 성공해야 다음 단계로 진행한다. 실패 시 즉시 중단하고 오류를 보고한다.

## 입력 파라미터

- **추가할 문제 수**: $ARGUMENTS (숫자, 생략 시 기본값 1)
- 숫자가 아닌 값이면 에러를 출력하고 중단한다.

## 실행 절차

---

### 1단계: 파일 구조 파악

js/questions.js 파일을 읽고 다음을 확인한다:

- QUESTIONS 배열이 존재하는지
- 각 문제 객체의 필수 필드: `id`, `category`, `difficulty`, `question`, `options`, `correctAnswer`, `explanation`
- CATEGORIES 배열이 존재하는지
- 유틸 함수(`getQuestionsByCategory`, `shuffleArray`)가 존재하는지

**성공 조건**: 위 구조가 모두 확인됨
**실패 시**: "❌ 1단계 실패: <구체적 원인>" 출력 후 중단

---

### 2단계: 현재 문제 분포 확인

모든 문제를 분석하여 아래 표를 출력한다:

```
📊 현재 문제 분포

| 카테고리      | easy | medium | hard | 합계 |
|--------------|------|--------|------|------|
| 한국사        |   ?  |   ?    |  ?   |  ?   |
| 과학          |   ?  |   ?    |  ?   |  ?   |
| 지리          |   ?  |   ?    |  ?   |  ?   |
| 예술과 문화    |   ?  |   ?    |  ?   |  ?   |
| 합계          |   ?  |   ?    |  ?   |  ?   |

마지막 ID: ?
```

**성공 조건**: 모든 문제의 category가 CATEGORIES에 포함되고, difficulty가 easy/medium/hard 중 하나
**실패 시**: "❌ 2단계 실패: ID ?번 문제의 <필드>가 잘못됨" 출력 후 중단

---

### 3단계: 부족한 부분 파악 및 추가 대상 결정

카테고리 × 난이도 조합을 분석하여 가장 부족한 조합을 찾는다.

**분석 기준** (우선순위 순):
1. 카테고리 합계가 가장 적은 카테고리 우선
2. 합계가 같으면 난이도별 균형이 가장 안 맞는 카테고리 우선
3. 난이도 내에서는 문제 수가 가장 적은 난이도 우선

추가할 문제 수만큼 (카테고리, 난이도) 조합 목록을 결정한다.

```
🎯 추가 대상

1. <카테고리> / <난이도> (현재 N개, 이유: ...)
2. <카테고리> / <난이도> (현재 N개, 이유: ...)
...
```

**성공 조건**: 추가 대상 목록이 결정됨
**실패 시**: 해당 없음 (이 단계는 항상 성공)

---

### 4단계: 중복 체크 및 문제 생성

추가 대상별로 새 문제를 생성한다. 생성 전 반드시 다음을 확인한다:

**중복 체크 항목:**
- 기존 문제와 동일한 질문이 있는지 (유사 표현 포함)
- 동일한 정답을 묻는 문제가 있는지 (예: "조선 건국 왕"과 "1392년 건국한 나라의 초대 왕")
- correctAnswer 인덱스가 0~3 범위인지

**문제 생성 시 CLAUDE.md 검증 가이드라인 적용:**
1. 정답 유일성: 정답이 하나뿐인가?
2. 최상급 표현 기준: 측정 기준이 명시되어 있는가?
3. 시간과 범위: 시점과 범위가 한정되어 있는가?
4. 교차 검증: 학술적으로 확립된 사실인가?

각 문제를 사용자에게 보여주고 승인을 받는다:

```
📝 새 문제 #N

카테고리: <카테고리>
난이도: <난이도>
ID: <번호>

Q. <질문>
  A. <선택지1>
  B. <선택지2>
  C. <선택지3>
  D. <선택지4>
정답: <정답 레이블>
해설: <해설>

✅ 검증 결과
1. 정답 유일성: 통과/위반
2. 최상급 표현: 통과/해당없음
3. 시간과 범위: 통과/해당없음
4. 교차 검증: 통과/위반
🔍 중복 체크: 통과 (유사 문제 없음) / 주의 (ID ?와 유사)
```

**성공 조건**: 사용자가 모든 문제를 승인
**실패 시**: "❌ 4단계 실패: 사용자가 문제를 거부함" 출력 후 중단. 사용자가 수정을 원하면 수정 후 재승인을 받는다.

---

### 5단계: 파일 삽입 및 형식 검증

승인된 문제를 js/questions.js에 삽입한다.

**삽입 규칙:**
- 해당 카테고리 섹션의 마지막 문제 뒤에 삽입
- 들여쓰기 2칸, 기존 코드 스타일 준수
- id는 기존 마지막 id + 1부터 순차 부여

**삽입 후 형식 검증:**
- 수정된 파일을 다시 읽어서 구문 오류가 없는지 확인
- 삽입한 문제의 필수 필드가 모두 존재하는지 재확인
- id 중복이 없는지 확인
- QUESTIONS 배열의 총 개수가 예상과 일치하는지 확인

**성공 조건**: 삽입 후 검증 통과
**실패 시**: "❌ 5단계 실패: <구체적 원인>" 출력 후 중단. 가능하면 삽입 전 상태로 복원을 시도한다.

---

### 6단계: 데이터 백업

수정된 js/questions.js의 백업 복사본을 생성한다.

**백업 위치**: 프로젝트 루트의 `backups/` 디렉토리
**백업 파일명**: `questions_YYYYMMDD_HHMMSS.js` (현재 시각 기준)

```bash
mkdir -p backups
cp js/questions.js backups/questions_<timestamp>.js
```

오래된 백업 정리: backups/ 내 파일이 10개를 초과하면 가장 오래된 것부터 삭제하여 10개를 유지한다.

**성공 조건**: 백업 파일이 생성되고, 원본과 내용이 일치
**실패 시**: "❌ 6단계 실패: 백업 생성 실패" 출력 (단, 이 단계 실패는 경고로 처리하고 계속 진행)

---

### 7단계: 실행 결과 보고

전체 작업 결과를 상세히 보고한다:

```
📋 일일 퀴즈 유지보수 완료

실행 시각: YYYY-MM-DD HH:MM:SS
소요 단계: 7/7 완료

📊 변경 전 → 변경 후
| 카테고리      | easy | medium | hard | 합계 |
|--------------|------|--------|------|------|
| 한국사        | ?→?  |  ?→?   | ?→?  | ?→?  |
| 과학          | ?→?  |  ?→?   | ?→?  | ?→?  |
| 지리          | ?→?  |  ?→?   | ?→?  | ?→?  |
| 예술과 문화    | ?→?  |  ?→?   | ?→?  | ?→?  |
| 합계          | ?→?  |  ?→?   | ?→?  | ?→?  |

📝 추가된 문제
1. [ID ?] <카테고리>/<난이도> — "<질문 요약>"
2. ...

🔒 백업: backups/questions_<timestamp>.js

✅ 모든 단계 정상 완료
```

---

## 오류 처리 정책

- 1~5단계 실패: 즉시 중단, 오류 보고, 파일 변경 없음
- 6단계 실패: 경고 출력 후 7단계로 진행 (백업은 선택적)
- 어느 단계든 예상치 못한 오류 발생 시: 현재까지 진행 상황을 보고하고 중단

```
❌ 일일 퀴즈 유지보수 중단

실패 단계: N단계
오류 내용: <상세 설명>
진행 상황: (N-1)/7 완료
파일 변경: 없음 / 있음 (복원 필요 여부)
```

## 주의사항

- 4단계에서 사용자 승인 없이 파일을 수정하지 마라.
- 문제 생성 시 CLAUDE.md의 검증 가이드라인을 반드시 적용한다.
- 백업 디렉토리(backups/)가 .gitignore에 포함되어 있는지 확인하고, 없으면 추가를 제안한다.
